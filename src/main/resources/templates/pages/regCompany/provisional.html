<!--decorated page-->
<html lang="en" dir="ltr" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layouts/basic-layout}">

<head>
  <title th:inline="text" th:text="#{label.list} + ' ' + 'RegEmpresa'"></title>

  <!-- Custom CSS from main page-->
</head>

<body>
<section layout:fragment="breadcrumb" th:remove="tag">

  <div class="page-breadcrumb">
    <div class="row">
      <div class="col-5 align-self-center">
        <h4 class="page-title" th:inline="text" th:text="#{label.list} + ' ' + 'RegEmpresa'"></h4>
        <div class="d-flex align-items-center">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a th:href="@{/index}" th:inline="text" th:text="#{label.home}"></a></li>
              <li class="breadcrumb-item active" aria-current="page" th:inline="text" th:text="#{label.list} + ' '  + 'RegEmpresa'"></li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>
</section>

<section layout:fragment="content" th:remove="tag">

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <th:block th:insert="fragments/service-response-painter" th:remove="tag"/>
          <div class="card-title col-lg-2">
            <button class="btn btn waves-effect waves-light btn-block btn-info"
                    th:inline="text" th:onclick="modalToggle()"><i class="fa fa-plus-circle pr-1"></i>[[#{action.new}]]</button>
          </div>
          <div class="table-responsive">
            <table id="tblRegEmpresa" class="table table-hover table-bordered" width="100%">
              <thead>
              <tr>
                <th>Acciones</th>
                <th>skEmpresa</th>
                <th>cdCcc</th>
                <th>stRazonSocial</th>
                <th>stNombres</th>
                <th>stApellidos</th>
                <th>stEmail</th>
                <th>extrangero</th>
                <th>dui</th>
                <th>nit</th>
                <th>nrc</th>
                <th>pasaporte</th>
                <th>cdActuaComo</th>
                <th>stDenominacion</th>
                <th>stDireccion</th>
                <th>stDireccionCobros</th>
                <th>stDireccionInmueble</th>
                <th>cdPropietarioInm</th>
                <th>stPropietarioInm</th>
                <th>stMatricula</th>
                <th>activoInicial</th>
                <th>fcInicioOperaciones</th>
                <th>comentario</th>
                <th>cdTipoActivo</th>
                <th>stNombreContador</th>
                <th>stApellidoContador</th>
                <th>skGeneroContador</th>
                <th>stEmailContador</th>
                <th>cdAprobado</th>
                <th>regSolicitudSkSolicitudDelegate</th>
                <th>skSolicitud</th>
                <th>regSolicitudSelect2Delegate</th>
              </tr>
              </thead>
            </table>
          </div>

        </div>
      </div>
    </div>
  </div>
  <!-- modal-content -->
  <div id="regEmpresaModal" class="modal bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myLargeModalLabel">RegEmpresa</h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
        </div>
        <form enctype="multipart/form-data" id="formRegEmpresa" class="needs-validation needs-validation-manual form-horizontal" novalidate th:action="@{/regEmpresa/save}" method="POST">
          <div class="modal-body">
            <div class="card-body">
              <div class="col-sm-12 col-lg-12">
                <div class="form-group row mb-3">
                  <label for="cdCcc" class="col-sm-2 text-right control-label col-form-label">cdCcc</label>
                  <div class="col-sm-9">
                    <textarea class="form-control" rows="5" id="cdCcc" name="cdCcc" ></textarea>
                    <span id="cdCccError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stRazonSocial" class="col-sm-2 text-right control-label col-form-label">stRazonSocial</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stRazonSocial" name="stRazonSocial"
                           placeholder="stRazonSocial"
                           maxlength="255" />
                    <span id="stRazonSocialError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stNombres" class="col-sm-2 text-right control-label col-form-label">stNombres</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stNombres" name="stNombres"
                           placeholder="stNombres"
                           maxlength="255" />
                    <span id="stNombresError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stApellidos" class="col-sm-2 text-right control-label col-form-label">stApellidos</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stApellidos" name="stApellidos"
                           placeholder="stApellidos"
                           maxlength="255" />
                    <span id="stApellidosError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stEmail" class="col-sm-2 text-right control-label col-form-label">stEmail</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stEmail" name="stEmail"
                           placeholder="stEmail" required
                           maxlength="255" />
                    <span id="stEmailError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="extrangero" class="col-sm-2 text-right control-label col-form-label">extrangero</label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="extrangero" name="extrangero"
                           placeholder="extrangero"
                           max="99999999999999999999999999999999"  />
                    <span id="extrangeroError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="dui" class="col-sm-2 text-right control-label col-form-label">dui</label>
                  <div class="col-sm-9">
                    <textarea class="form-control" rows="5" id="dui" name="dui" ></textarea>
                    <span id="duiError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="nit" class="col-sm-2 text-right control-label col-form-label">nit</label>
                  <div class="col-sm-9">
                    <textarea class="form-control" rows="5" id="nit" name="nit" ></textarea>
                    <span id="nitError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="nrc" class="col-sm-2 text-right control-label col-form-label">nrc</label>
                  <div class="col-sm-9">
                    <textarea class="form-control" rows="5" id="nrc" name="nrc" ></textarea>
                    <span id="nrcError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="pasaporte" class="col-sm-2 text-right control-label col-form-label">pasaporte</label>
                  <div class="col-sm-9">
                    <textarea class="form-control" rows="5" id="pasaporte" name="pasaporte" ></textarea>
                    <span id="pasaporteError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="cdActuaComo" class="col-sm-2 text-right control-label col-form-label">cdActuaComo</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="cdActuaComo" name="cdActuaComo"
                           placeholder="cdActuaComo"
                           maxlength="1" />
                    <span id="cdActuaComoError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stDenominacion" class="col-sm-2 text-right control-label col-form-label">stDenominacion</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stDenominacion" name="stDenominacion"
                           placeholder="stDenominacion"
                           maxlength="255" />
                    <span id="stDenominacionError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stDireccion" class="col-sm-2 text-right control-label col-form-label">stDireccion</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stDireccion" name="stDireccion"
                           placeholder="stDireccion"
                           maxlength="255" />
                    <span id="stDireccionError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stDireccionCobros" class="col-sm-2 text-right control-label col-form-label">stDireccionCobros</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stDireccionCobros" name="stDireccionCobros"
                           placeholder="stDireccionCobros"
                           maxlength="255" />
                    <span id="stDireccionCobrosError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stDireccionInmueble" class="col-sm-2 text-right control-label col-form-label">stDireccionInmueble</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stDireccionInmueble" name="stDireccionInmueble"
                           placeholder="stDireccionInmueble"
                           maxlength="255" />
                    <span id="stDireccionInmuebleError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="cdPropietarioInm" class="col-sm-2 text-right control-label col-form-label">cdPropietarioInm</label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="cdPropietarioInm" name="cdPropietarioInm"
                           placeholder="cdPropietarioInm"
                           max="99999999999999999999999999999999"  />
                    <span id="cdPropietarioInmError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stPropietarioInm" class="col-sm-2 text-right control-label col-form-label">stPropietarioInm</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stPropietarioInm" name="stPropietarioInm"
                           placeholder="stPropietarioInm"
                           maxlength="255" />
                    <span id="stPropietarioInmError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stMatricula" class="col-sm-2 text-right control-label col-form-label">stMatricula</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stMatricula" name="stMatricula"
                           placeholder="stMatricula"
                           maxlength="255" />
                    <span id="stMatriculaError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="activoInicial" class="col-sm-2 text-right control-label col-form-label">activoInicial</label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="activoInicial" name="activoInicial"
                           placeholder="activoInicial"
                           max=""  />
                    <span id="activoInicialError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="fcInicioOperaciones" class="col-sm-2 text-right control-label col-form-label">fcInicioOperaciones</label>
                  <div class="col-sm-9">
                    <div class="input-group">
                      <input type="text" class="form-control datepicker-initializer" id="fcInicioOperaciones" name="fcInicioOperaciones"
                             placeholder="dd/mm/yyyy"  />
                      <div class="input-group-append">
                        <span class="input-group-text" style="height: 100%;"><i class="fa fa-calendar"></i></span>
                      </div>
                    </div>
                    <span id="fcInicioOperacionesError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="comentario" class="col-sm-2 text-right control-label col-form-label">comentario</label>
                  <div class="col-sm-9">
                    <textarea class="form-control" rows="5" id="comentario" name="comentario" ></textarea>
                    <span id="comentarioError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="cdTipoActivo" class="col-sm-2 text-right control-label col-form-label">cdTipoActivo</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="cdTipoActivo" name="cdTipoActivo"
                           placeholder="cdTipoActivo" required
                           maxlength="1" />
                    <span id="cdTipoActivoError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stNombreContador" class="col-sm-2 text-right control-label col-form-label">stNombreContador</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stNombreContador" name="stNombreContador"
                           placeholder="stNombreContador" required
                           maxlength="255" />
                    <span id="stNombreContadorError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stApellidoContador" class="col-sm-2 text-right control-label col-form-label">stApellidoContador</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stApellidoContador" name="stApellidoContador"
                           placeholder="stApellidoContador" required
                           maxlength="255" />
                    <span id="stApellidoContadorError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="skGeneroContador" class="col-sm-2 text-right control-label col-form-label">skGeneroContador</label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="skGeneroContador" name="skGeneroContador"
                           placeholder="skGeneroContador" required
                           max="99999999999999999999999999999999"  />
                    <span id="skGeneroContadorError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="stEmailContador" class="col-sm-2 text-right control-label col-form-label">stEmailContador</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="stEmailContador" name="stEmailContador"
                           placeholder="stEmailContador" required
                           maxlength="255" />
                    <span id="stEmailContadorError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row mb-3">
                  <label for="cdAprobado" class="col-sm-2 text-right control-label col-form-label">cdAprobado</label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="cdAprobado" name="cdAprobado"
                           placeholder="cdAprobado"
                           max="99999999999999999999999999999999"  />
                    <span id="cdAprobadoError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="regSolicitudSelect2Delegate" class="col-sm-2 text-right control-label col-form-label">skSolicitud</label>
                  <div class="col-sm-9">
                    <select class="select2" id="regSolicitudSelect2Delegate" name="regSolicitud" required>

                    </select>
                    <span id="regSolicitudSelect2DelegateError" style="display: none; color: red;">Campo obligatorio</span>
                  </div>
                </div>
                <input type="hidden" id="skEmpresa" name="skEmpresa"/>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-info waves-effect waves-light" th:text="#{action.save}"></button>
            <button type="button" class="btn btn-danger waves-effect text-left" data-bs-dismiss="modal" th:text="#{action.cancel}"></button>
          </div>
        </form>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
</section>

<section layout:fragment="js" th:remove="tag">
  <!-- Required libraries -->

  <script th:inline="javascript">
    const urlRegSolicitudSelect2 = /*[[@{/regSolicitud/cboFilterS2}]]*/"";
    const urlRegEmpresaDataTable = /*[[@{/regEmpresa/list}]]*/"";
    const urlGetRegEmpresa = /*[[@{/regEmpresa/form}]]*/"";
    const urlSaveRegEmpresa = /*[[@{/regEmpresa/save}]]*/"";
    const urlDeleteRegEmpresa = /*[[@{/regEmpresa/delete}]]*/"";
  </script>
  <script>
    /*DatePicker init*/
    jQuery('.datepicker-initializer').datepicker({
      format: "dd/mm/yyyy",
      autoclose: true,
      todayHighlight: true,
      orientation: "bottom",
      language: "es"
    });

    renderSelect2('#regSolicitudSelect2Delegate', urlRegSolicitudSelect2, 5);

    var table = $('table#tblRegEmpresa').DataTable({
      ajax: urlRegEmpresaDataTable,
      serverSide: true,
      orderCellsTop: true,
      fixedHeader: true,
      columns: [
        {
          targets: -1,
          data: null,
          searchable: false,
          orderable: false,
          width: "10%",
          render: function (data, type, row) {
            var id = row.skEmpresa;
            return '<div class="button-group" style="display: inline-flex;">' +
                    '<button class="btn waves-effect waves-light btn-success" type="button" onClick="ajaxEdit(' + id + ')" id="btnEditar_' + id + '" > <i class="fa fa-pencil-alt"></i></button>' +
                    '<button class="btn waves-effect waves-light btn-danger" type="button" onClick="ajaxDelete(' + id + ')" id="btnEliminar_' + id + '" > <i class="fa fa-trash"></i> </button>' +
                    '</div>';
          }
        }
        , {
          data: 'skEmpresa',
          orderable: false
          , visible: false
          , searchable: false
        }
        , {
          data: 'cdCcc'
          , orderable: false
        }
        , {
          data: 'stRazonSocial'
          , orderable: false
        }
        , {
          data: 'stNombres'
          , orderable: false
        }
        , {
          data: 'stApellidos'
          , orderable: false
        }
        , {
          data: 'stEmail'
          , orderable: false
        }
        , {
          data: 'extrangero'
          , orderable: false
        }
        , {
          data: 'dui'
          , orderable: false
        }
        , {
          data: 'nit'
          , orderable: false
        }
        , {
          data: 'nrc'
          , orderable: false
        }
        , {
          data: 'pasaporte'
          , orderable: false
        }
        , {
          data: 'cdActuaComo'
          , orderable: false
        }
        , {
          data: 'stDenominacion'
          , orderable: false
        }
        , {
          data: 'stDireccion'
          , orderable: false
        }
        , {
          data: 'stDireccionCobros'
          , orderable: false
        }
        , {
          data: 'stDireccionInmueble'
          , orderable: false
        }
        , {
          data: 'cdPropietarioInm'
          , orderable: false
        }
        , {
          data: 'stPropietarioInm'
          , orderable: false
        }
        , {
          data: 'stMatricula'
          , orderable: false
        }
        , {
          data: 'activoInicial'
          , orderable: false
        }
        , {
          data: 'fcInicioOperaciones'
          , orderable: false
          , filterType: "date"
        }
        , {
          data: 'comentario'
          , orderable: false
        }
        , {
          data: 'cdTipoActivo'
          , orderable: false
        }
        , {
          data: 'stNombreContador'
          , orderable: false
        }
        , {
          data: 'stApellidoContador'
          , orderable: false
        }
        , {
          data: 'skGeneroContador'
          , orderable: false
        }
        , {
          data: 'stEmailContador'
          , orderable: false
        }
        , {
          data: 'cdAprobado'
          , orderable: false
        }
        , {
          data: 'regSolicitudSkSolicitudDelegate',
          visible: false,
          searchable: false
        }
        , {
          data: 'regSolicitud.skSolicitud',
          render: function (data, type, row) {
            return row.regSolicitudStDescripcionDelegate;
          },
          orderable: false,
          filterType: "select2",
          filterUrl: urlRegSolicitudSelect2
        }
        , {
          data: 'regSolicitudSelect2Delegate',
          visible: false,
          searchable: false
        }
      ]
    });

    crearFiltrosDataTable("#tblRegEmpresa", table);

    table.findById = function(id) {
      return this.data()
              .filter( function ( value, index ) {
                return parseInt(id) === parseInt(value.skEmpresa);
              })[0];
    };

    //Modal launch and clear Form
    function modalToggle(){
      var form = $("#formRegEmpresa");
      resetForm(form);
      $('#regEmpresaModal').modal('toggle');
    }

    //Ajax Save for Modal, called after submit validation.
    function ajaxSave(){
      var id = $("#skEmpresa").val();
      var mensaje = id ? 'Se editará el registro' : 'Se guardará un nuevo registro';
      Swal.fire({
        title: "¿Está seguro?",
        text: mensaje,
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: '#d33',
        confirmButtonText: "Si",
        cancelButtonText: "No"
      }).then(function (e) {
        if (e.value === true) {
          $.ajax({
            data: $("#formRegEmpresa").serialize(),
            url: urlSaveRegEmpresa,
            type: "POST",
            success: function (result) {
              if (result.success === true) {
                Swal.fire({title: "¡Guardado!", text: result.message, type:'success'});
                $('#regEmpresaModal').modal('toggle');
                $('#tblRegEmpresa').DataTable().ajax.reload();
              }else{
                Swal.fire({title: "Error!", text: result.message, type:'error'});
              }
            },
            error: function (x, e,  thrownError) {
              Swal.fire({title: "Error!", text: "Error interno del servidor.", type:'error'});
            }
          });
        }
      });
      return false;
    }

    //Ajax Edit
    function ajaxEdit(id){
      var skEmpresa = id;
      var form = $("#formRegEmpresa");
      $.ajax({
        data: {skEmpresa : skEmpresa},
        url: urlGetRegEmpresa,
        type: 'GET',
        success: function (result){
          if(result !== null){
            fillForm(form, result);
            $('#regEmpresaModal').modal('toggle');
          }else{
            Swal.fire({title: "Error!", text: "No se encontró el registro seleccionado.", type:'error'});
          }
        },
        error: function (xhr, status) {
          Swal.fire({title: "Error!", text: "Error interno del servidor.", type:'error'});
        }
      });
    }

    //Ajax Delete
    function ajaxDelete(id){
      var skEmpresa = id;
      Swal.fire({
        title: '¿Está seguro?',
        text: "Se eliminará el registro",
        type: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Si',
        cancelButtonText: 'No'
      }).then(function(e) {
        if (e.value === true) {
          $.ajax({
            data: {skEmpresa : skEmpresa} ,
            url: urlDeleteRegEmpresa,
            type: 'POST',
            success: function (result) {
              if (result.success === true) {
                Swal.fire({title: "¡Eliminado!", text: result.message, type:'success'});
                $('#tblRegEmpresa').DataTable().ajax.reload();
              } else {
                Swal.fire({title: "¡Error!", text: result.message, type:'error'});
              }
            },
            error: function (x, e,  thrownError) {
              Swal.fire({title: "¡Error!", text: "Error interno del servidor.", type:'error'});
            }
          });
        }
      });
    }

    /* Submit validation, antes de ejecutar la funcion de guardado ajaxSave() */
    $('#formRegEmpresa').submit(function(event){
      var formulario =  $('#formRegEmpresa');

      // cancels the form submission
      event.preventDefault();
      event.stopPropagation();

      var validacionBootstrapCorrecta = formulario[0].checkValidity();
      var validacionManualCorrecta = Validador.validarFormulario(formulario);
      if (validacionBootstrapCorrecta && validacionManualCorrecta) {
        ajaxSave();
      }
      formulario.addClass('was-validated');
    });
  </script>
</section>
</body>

</html>
